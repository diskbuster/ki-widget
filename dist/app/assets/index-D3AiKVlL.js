import{r as e,a as t}from"./vendor-liIMdADX.js";import{A as n,R as r,X as s}from"./ui-DqDCgslo.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var o={exports:{}},i={},a=e,l=Symbol.for("react.element"),c=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,u=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function f(e,t,n){var r,s={},o=null,i=null;for(r in void 0!==n&&(o=""+n),void 0!==t.key&&(o=""+t.key),void 0!==t.ref&&(i=t.ref),t)d.call(t,r)&&!p.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:l,type:e,key:o,ref:i,props:s,_owner:u.current}}i.Fragment=c,i.jsx=f,i.jsxs=f,o.exports=i;var h,m=o.exports,g=t;function x(e){try{return JSON.parse(e)}catch{return null}}function b({item:e}){const t=e.pfad?`https://www.ausbildungsregion-osnabrueck.de/${e.pfad.replace(/^\/+/,"")}`:void 0;return m.jsxs("div",{className:"card",style:{border:"1px solid #e5e7eb",borderRadius:8,padding:16,marginBottom:12},children:[m.jsx("h3",{style:{margin:"0 0 6px 0",fontSize:18},children:t?m.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:m.jsx("b",{children:e.name})}):m.jsx("b",{children:e.name})}),e.ort?m.jsxs("p",{style:{margin:"0 0 8px 0"},children:["Ort: ",e.ort]}):null,Array.isArray(e.ausbildungsberufe)&&e.ausbildungsberufe.length>0?m.jsx("ul",{style:{margin:"10px 0 0 18px"},children:e.ausbildungsberufe.slice(0,10).map(((e,t)=>m.jsx("li",{children:e},t)))}):null]})}function y({role:t,content:n,isStreaming:r}){const[s,o]=e.useState([]),i=e.useRef(!1),a=e.useRef("");return e.useEffect((()=>{if("assistant"!==t)return;a.current=n||"";const{completeItems:e,includeBerufeLink:r}=function(e){const t={completeItems:[],includeBerufeLink:void 0,consumedUntil:0},n=/"includeBerufeLink"\s*:\s*(true|false)/.exec(e);n&&(t.includeBerufeLink="true"===n[1]);const r=e.indexOf('"items"');if(-1===r)return t;const s=e.indexOf("[",r);if(-1===s)return t;let o=s+1,i=0,a=!1,l=!1,c=-1;for(;o<e.length;){const n=e[o];if(a)l?l=!1:"\\"===n?l=!0:'"'===n&&(a=!1),o++;else if('"'!==n){if("{"===n)0===i&&(c=o),i++;else if("}"===n){if(i--,0===i&&c>=0){const n=x(e.slice(c,o+1));n&&n.name&&(t.completeItems.push(n),t.consumedUntil=o+1),c=-1}}else if("]"===e[o]){t.consumedUntil=Math.max(t.consumedUntil,o+1);break}o++}else a=!0,o++}return t}(a.current);!0===r&&(i.current=!0),e.length>0&&o((t=>{const n=new Set(t.map((e=>`${e.name}__${e.pfad||""}`))),r=[...t];for(const s of e){const e=`${s.name}__${s.pfad||""}`;n.has(e)||(n.add(e),r.push(s))}return r}))}),[t,n]),e.useEffect((()=>{if(!r&&"assistant"===t&&a.current){const e=x(a.current);!0===(null==e?void 0:e.includeBerufeLink)&&(i.current=!0)}}),[r,t]),"assistant"!==t?m.jsx("div",{className:"whitespace-pre-wrap",children:n}):r?0===s.length?m.jsx("div",{className:"text-sm text-gray-500",children:"Ich suche passende Betriebe …"}):m.jsx("div",{children:s.map(((e,t)=>m.jsx(b,{item:e},`${e.name}__${e.pfad||t}`)))}):0===s.length?m.jsx("div",{className:"whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:n}}):m.jsxs("div",{children:[s.map(((e,t)=>m.jsx(b,{item:e},`${e.name}__${e.pfad||t}`))),i.current&&m.jsx("p",{style:{marginTop:8},children:m.jsx("a",{href:"https://www.ausbildungsregion-osnabrueck.de/berufelexikon",target:"_blank",rel:"noopener noreferrer",children:m.jsx("button",{className:"px-4 py-2 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200 transition-colors cursor-pointer text-sm",children:m.jsx("b",{children:"Weitere Ausbildungsberufe findest Du in unserem Berufelexikon"})})})})]})}h=g.createRoot,g.hydrateRoot;const w=({onSend:t,disabled:r,settings:s})=>{const[o,i]=e.useState(""),a=e.useRef(null);return m.jsx("form",{onSubmit:e=>{var n;e.preventDefault(),o.trim()&&!r&&(t(o),i(""),null==(n=a.current)||n.focus())},className:"p-4 bg-white",children:m.jsxs("div",{className:"flex items-center gap-2 rounded-xl\n        bg-gray-100 p-2",children:[m.jsx("input",{ref:a,type:"text",value:o,onChange:e=>i(e.target.value),placeholder:s.input_placeholder,className:"flex-1 px-1 focus:outline-none bg-transparent"}),m.jsx("button",{type:"submit",disabled:r||!o.trim(),className:"p-2 rounded-xl bg-blue-600 text-white disabled:opacity-50 disabled:cursor-default disabled:pointer-events-none disabled:bg-gray-300 hover:bg-blue-700 transition-colors",children:m.jsx(n,{className:"w-4 h-4"})})]})})},v="https://botserver.lab49.de",_="chatThreadId",j="chatMessages",S=e=>e&&"object"==typeof e&&Array.isArray(e.items)&&e.items.every((e=>e&&"object"==typeof e&&"string"==typeof e.name&&"string"==typeof e.ort&&"string"==typeof e.pfad)),N=e=>{let t=0,n=!1,r=!1;for(let o=0;o<e.length;o++){const s=e[o];r?r=!1:"\\"!==s?'"'!==s?n||("{"===s?t++:"}"===s&&t--):n=!n:r=!0}const s=e.trim();return 0===t&&s.startsWith("{")&&s.endsWith("}")};function k(){var t;const[n,o]=e.useState((()=>{const e=localStorage.getItem(j);return e?JSON.parse(e):[]})),[i,a]=e.useState({welcome_text:"Willkommen! Wie kann ich Ihnen heute helfen?",title:"Auregios Chatbot",show_poweredby:!0,input_placeholder:"Schreibe Deine Frage...",loading_api:"Ich denke nach ...",loading_openai:"Ich denke nach ...",tooltip_reset:"Chat zurücksetzen",tooltip_close:"Chat schließen",loading_app:"Chat laden...",predefined_questions:["Welche Ausbildungsberufe gibt es?","Finde Malerbetriebe in Melle."]}),[l,c]=e.useState(!1),d=e.useRef(null),[u,p]=e.useState((()=>localStorage.getItem(_))),[f,h]=e.useState(!0),[g,x]=e.useState(null),b=e.useRef(null),k=()=>{var e;null==(e=d.current)||e.scrollIntoView({behavior:"smooth"})};if(e.useEffect((()=>{(async()=>{try{const e=new URLSearchParams(window.location.search).get("id");if(e){x(e);const t=await fetch(`${v}/settings?id=${e}`);let n;if(!t.ok)throw new Error("Failed to load settings");n={...i,...await t.json()},a(n)}}catch(e){console.error("Fehler beim Laden der Einstellungen:",e),a((e=>({...e,welcome_text:e.welcome_text||"Willkommen! Wie kann ich Ihnen heute helfen?",title:e.title||"Auregios Chatbot",input_placeholder:e.input_placeholder||"Schreibe Deine Frage...",loading_api:e.loading_api||"Ich denke nach ...",loading_openai:e.loading_openai||"Ich denke nach ...",tooltip_reset:e.tooltip_reset||"Chat zurücksetzen",tooltip_close:e.tooltip_close||"Chat schließen",loading_app:e.loading_app||"Chat laden..."})))}finally{h(!1),setTimeout(k,500)}})()}),[]),e.useEffect((()=>{setTimeout(k,100)}),[n]),e.useEffect((()=>{localStorage.setItem(j,JSON.stringify(n))}),[n]),f)return m.jsx("div",{className:"flex flex-col h-screen bg-white items-center justify-center",children:m.jsx("div",{className:"mt-4 text-gray-600",children:i.loading_app||"Chat laden..."})});const I=async e=>{var t,n;o((t=>[...t,{role:"user",content:e}])),c(!0),o((e=>{const t=[...e,{role:"assistant",content:i.loading_api||""}];return b.current=t.length-1,t}));const r=new AbortController,s=window.setTimeout((()=>r.abort()),45e3);let a="",l="",d=!1,f="",h="";const m=e=>{o((t=>{const n=b.current;if(null==n||n<0||n>=t.length)return t;const r=t[n];return[...t.slice(0,n),{...r,...e},...t.slice(n+1)]}))};try{const s={"Content-Type":"application/json"};u&&(s["x-thread-id"]=u);const o=new URLSearchParams(window.location.search).get("id")||null,c=await fetch(`${v}/chat`,{method:"POST",headers:s,signal:r.signal,body:JSON.stringify({message:e,widgetId:o,settings:i})});if(!c.ok||!c.body)throw new Error(`HTTP ${c.status}`);const g=c.body.getReader(),x=new TextDecoder("utf-8");let b=!1;for(;!b;){const{value:e,done:r}=await g.read();if(b=r,e){a+=x.decode(e,{stream:!0});const r=a.split("\n\n");a=r.pop()||"";for(const e of r){if(!e.startsWith("data:"))continue;const r=e.slice(5).trim();if(!r)continue;if("[DONE]"===r){if(!d&&N(l))try{const e=JSON.parse(l);S(e)&&(m({content:"",payload:e}),d=!0)}catch{}b=!0;break}let s=!1;try{const e=JSON.parse(r);if(s=!0,null==(t=null==e?void 0:e.info)?void 0:t.id){p(e.info.id),localStorage.setItem(_,e.info.id);continue}if(S(e)){m({content:"",payload:e}),d=!0,l=JSON.stringify(e);continue}if("string"==typeof(null==e?void 0:e.content)&&!d){f+=e.content,m({content:f});continue}}catch{}if(!s)if(l+=r,N(l))try{const e=JSON.parse(l);if(null==(n=null==e?void 0:e.info)?void 0:n.id){p(e.info.id),localStorage.setItem(_,e.info.id),l="";continue}if(S(e)){m({content:"",payload:e}),d=!0,l="";continue}if("string"==typeof(null==e?void 0:e.content)&&!d){f+=e.content,m({content:f}),l="";continue}l=""}catch{}else/<div\s+class=["']card["']/.test(r)&&!d?(h+=r,m({content:h})):d||/<[a-z][\s\S]*>/i.test(r)||(f+=r,m({content:f}))}}}}catch(g){m({content:"AbortError"===(null==g?void 0:g.name)?"Zeitüberschreitung nach 45s. Bitte nochmal versuchen.":`Fehler: ${(null==g?void 0:g.message)||String(g)}`})}finally{window.clearTimeout(s),c(!1),setTimeout(k,50)}};return m.jsxs("div",{className:"flex flex-col h-screen bg-white",children:[m.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[m.jsx("h1",{className:"text-xl font-semibold",children:i.title}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs("button",{onClick:()=>{o([]),p(null),b.current=null,localStorage.removeItem(_),localStorage.removeItem(j)},className:"p-2 rounded-lg hover:bg-gray-100 transition-colors text-gray-300 hover:text-gray-800 relative group","aria-label":i.tooltip_reset,children:[m.jsx(r,{className:"w-5 h-5"}),m.jsx("span",{className:"z-10 absolute text-nowrap right-0 mt-3 opacity-0 group-hover:opacity-100 bg-gray-800 text-white text-xs py-1 px-2 rounded transition-opacity delay-500 pointer-events-none",children:i.tooltip_reset})]}),m.jsxs("button",{onClick:()=>{window.parent.postMessage("close-chat","*")},className:"p-2 rounded-lg hover:bg-gray-100 transition-colors relative group","aria-label":i.tooltip_close,children:[m.jsx(s,{className:"w-5 h-5"}),m.jsx("span",{className:"z-10 absolute text-nowrap right-0 mt-3 opacity-0 group-hover:opacity-100 bg-gray-800 text-white text-xs py-1 px-2 rounded transition-opacity delay-500 pointer-events-none",children:i.tooltip_close})]})]})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[0===n.length&&i.welcome_text&&m.jsxs("div",{className:"text-center px-4 py-2 rounded-lg text-gray-600 mb-4",children:[m.jsx("p",{children:i.welcome_text}),(null==(t=i.predefined_questions)?void 0:t.length)?m.jsx("div",{className:"flex flex-wrap justify-center gap-2 mt-4",children:i.predefined_questions.map(((e,t)=>m.jsx("button",{onClick:()=>{I(e)},className:"px-4 py-2 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200 transition-colors cursor-pointer text-sm",children:e},t)))}):null]}),n.map(((e,t)=>m.jsx(y,{id:g,message:e,isStreaming:l&&t===n.length-1,threadId:u,messageHistory:n},t))),m.jsx("div",{ref:d})]}),m.jsx(w,{onSend:I,disabled:l,settings:{input_placeholder:i.input_placeholder}}),i.show_poweredby&&m.jsx("a",{href:"https://kasper.digital",target:"_blank",className:"pb-2 bg-white text-center text-xs text-gray-500",rel:"noopener noreferrer",children:"Powered by kasper.digital"}),m.jsx("style",{children:"\n        .card {\n          background: #ffffff;\n          border: 1px solid #e0e0e0;\n          border-radius: 12px;\n          padding: 1rem 1.25rem;\n          margin-bottom: 0.75rem;\n          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);\n          transition: box-shadow 0.2s ease;\n        }\n        .card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }\n        .card h3 { margin: 0 0 6px 0; font-size: 1.1rem; font-weight: 700; }\n        .card p { margin: 4px 0 0 0; font-size: 0.95rem; color: #444; }\n        .card ul { margin: 8px 0 0 0; padding-left: 1.25rem; list-style: disc; color: #333; font-size: 0.95rem; }\n        .card li { margin-bottom: 2px; }\n      "})]})}h(document.getElementById("root")).render(m.jsx(e.StrictMode,{children:m.jsx(k,{})}));
